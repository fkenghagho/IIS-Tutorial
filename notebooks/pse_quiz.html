<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the Inter font and a smooth appearance */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc;
        }
        .quiz-card {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
        }
        /* Styles for correct/incorrect borders on selection */
        select.correct {
            border-color: #10b981 !important;
            box-shadow: 0 0 0 1px #10b981;
        }
        select.incorrect {
            border-color: #ef4444 !important;
            box-shadow: 0 0 0 1px #ef4444;
        }
        .disabled-button {
            opacity: 0.5;
            cursor: not-allowed;
        }
        /* Style for mathematical variables (makes them italic) */
        .math-var { font-style: italic; } 
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'robot-blue': '#1c4d96',
                        'robot-green': '#10b981',
                        'robot-red': '#ef4444',
                    }
                }
            }
        }
    </script>
</head>
<body>

<div id="app" class="min-h-screen p-4 sm:p-8 flex justify-center items-start">
    <div class="w-full max-w-4xl bg-white p-6 sm:p-10 rounded-xl quiz-card mt-8">
        <p class="text-lg text-gray-600 mb-8">Test your knowledge on the probability theory foundation, the structure of the Bayes filter, and its primary implementations (Kalman & Particle Filters). You must answer all 9 questions before checking your results.</p>

        <div id="quiz-container">
            <!-- Questions will be dynamically inserted here -->
        </div>

        <button 
            id="action-button" 
            onclick="handleAction()"
            class="w-full mt-8 px-6 py-3 bg-robot-blue text-white font-bold rounded-lg shadow-lg hover:bg-blue-700 transition duration-300 transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-robot-blue/50 disabled-button"
            disabled
        >
            Check Answers (0/9 Completed)
        </button>
        
        <div id="status-message" class="mt-4 text-center text-robot-red font-medium hidden">
            Please answer all 9 questions before checking your results.
        </div>

        <div id="results" class="mt-8 pt-6 border-t border-gray-200 hidden">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">Your Results:</h2>
            <p id="score-display" class="text-xl font-bold text-gray-800">Score: 0 / 9</p>
            <p id="feedback-message" class="mt-2 text-lg"></p>
        </div>

    </div>
</div>

<script>
    const QUIZ_LENGTH = 9;
    let quizChecked = false; // State to track if the quiz has been checked

    // Define the quiz data structure with 9 questions
    const quizData = [
        // --- M5_1.pdf: Probability Theory and Statistics Summary (3 Questions) ---
        { id: 1, concept: "Continuous Random Variables", 
            question: "What does the integral of a continuous Probability Density Function (PDF), <span class='math-var'>p</span>(<span class='math-var'>x</span>), over the entire domain equal?", 
            options: [
                { text: "0", isCorrect: false }, 
                { text: "1", isCorrect: true }, 
                { text: "The mean of the variable", isCorrect: false }, 
                { text: "The variance of the variable", isCorrect: false }
            ] },
        { id: 2, concept: "Covariance Matrix", 
            question: "In a Multivariate Gaussian Distribution, what does the <span class='font-bold'>C</span> matrix (Covariance Matrix) primarily represent?", 
            options: [
                { text: "The mean vector of the variables", isCorrect: false }, 
                { text: "The independence and correlation between the variables", isCorrect: true }, 
                { text: "The inverse of the precision matrix", isCorrect: false }, 
                { text: "The cumulative distribution function", isCorrect: false }
            ] },
        { id: 3, concept: "Nonparametric Distributions", 
            question: "A distribution that is represented by a set of samples rather than being defined by a fixed set of parameters (like mean and variance) is called a:", 
            options: [
                { text: "Uniform Distribution", isCorrect: false }, 
                { text: "Parametric Distribution", isCorrect: false }, 
                { text: "Conditional Distribution", isCorrect: false }, 
                { text: "Nonparametric Distribution", isCorrect: true }
            ] },

        // --- M5_2.pdf: Theory of State Estimation (3 Questions) ---
        { id: 4, concept: "Markov Assumption", 
            question: "In the context of probabilistic state estimation, the Markov Assumption simplifies the state dynamics by stating that the future state <span class='math-var'>x</span><sub>t</sub> is conditionally independent of past states, given what?", 
            options: [
                { text: "The immediate previous state <span class='math-var'>x</span><sub>t-1</sub> and the current control input <span class='math-var'>u</span><sub>t</sub>", isCorrect: true }, 
                { text: "All past measurements <span class='math-var'>z</span><sub>1:t-1</sub>", isCorrect: false }, 
                { text: "Only the current control input <span class='math-var'>u</span><sub>t</sub>", isCorrect: false }, 
                { text: "The total probability", isCorrect: false }
            ] },
        { id: 5, concept: "Bayesian Belief", 
            question: "In Bayesian filtering, the Belief Bel(<span class='math-var'>x</span><sub>t</sub>) represents which posterior probability?", 
            options: [
                { text: "P(state <span class='math-var'>x</span><sub>t</sub> | control <span class='math-var'>u</span><sub>t</sub>)", isCorrect: false }, 
                { text: "P(measurement <span class='math-var'>z</span><sub>t</sub> | state <span class='math-var'>x</span><sub>t</sub>)", isCorrect: false }, 
                { text: "P(<span class='math-var'>x</span><sub>t</sub> | <span class='math-var'>u</span><sub>1:t</sub>, <span class='math-var'>z</span><sub>1:t</sub>)", isCorrect: true }, 
                { text: "P(<span class='math-var'>x</span><sub>t+1</sub> | <span class='math-var'>u</span><sub>1:t</sub>, <span class='math-var'>z</span><sub>1:t</sub>)", isCorrect: false }
            ] },
        { id: 6, concept: "Bayesian Filtering Phases", 
            question: "Which two fundamental phases constitute the recursive application of the Bayes filter?", 
            options: [
                { text: "Initialization and Termination", isCorrect: false }, 
                { text: "Mapping and Localization", isCorrect: false }, 
                { text: "Prediction and Measurement Update", isCorrect: true }, 
                { text: "Calibration and Validation", isCorrect: false }
            ] },

        // --- M5_3.pdf: Bayes Filter Implementations (3 Questions) ---
        { id: 7, concept: "Gaussian Filter (Kalman Filter)", 
            question: "For the standard Gaussian Filter (Kalman Filter) to work optimally, what key assumptions must hold regarding the motion and observation models?", 
            options: [
                { text: "The models must be linear and the noise must be Gaussian", isCorrect: true }, 
                { text: "The environment must be static and known", isCorrect: false }, 
                { text: "The models must be non-linear and nonparametric", isCorrect: false }, 
                { text: "The motion must be deterministic (without noise)", isCorrect: false }
            ] },
        { id: 8, concept: "Particle Filter Representation", 
            question: "How does the Particle Filter (PF) represent the arbitrary, potentially non-Gaussian, probability distribution of the state?", 
            options: [
                { text: "As a set of Gaussian components", isCorrect: false }, 
                { text: "As a single mean vector and a covariance matrix", isCorrect: false }, 
                { text: "As a set of weighted samples (particles)", isCorrect: true }, 
                { text: "As a grid of probability values", isCorrect: false }
            ] },
        { id: 9, concept: "Particle Filter Importance Weights", 
            question: "In the particle set <span class='math-var'>X</span> = {(<span class='math-var'>x</span><sup>[i]</sup>, <span class='math-var'>w</span><sup>[i]</sup>)}, what does the scalar value <span class='math-var'>w</span><sup>[i]</sup> (the importance weight) primarily represent?", 
            options: [
                { text: "The estimated position of the particle", isCorrect: false }, 
                { text: "The age of the particle", isCorrect: false }, 
                { text: "The probability of the state hypothesis <span class='math-var'>x</span><sup>[i]</sup> given the measurement <span class='math-var'>z</span><sub>t</sub>", isCorrect: true }, 
                { text: "The average weight of all particles", isCorrect: false }
            ] }
    ];

    /**
     * Toggles the state of the main action button based on completion.
     */
    function updateButtonState() {
        const actionButton = document.getElementById('action-button');
        const selectElements = document.querySelectorAll('#quiz-container select');
        
        let answeredCount = 0;
        selectElements.forEach(select => {
            if (select.value !== "") {
                answeredCount++;
            }
        });

        if (quizChecked) {
            actionButton.textContent = "Reset Quiz to Try Again";
            actionButton.classList.remove('disabled-button', 'bg-robot-blue', 'hover:bg-blue-700');
            actionButton.classList.add('bg-robot-red', 'hover:bg-red-700');
            actionButton.disabled = false;
        } else if (answeredCount === QUIZ_LENGTH) {
            actionButton.textContent = `Check Answers (${QUIZ_LENGTH}/${QUIZ_LENGTH} Completed)`;
            actionButton.classList.remove('disabled-button', 'bg-robot-red', 'hover:bg-red-700');
            actionButton.classList.add('bg-robot-blue', 'hover:bg-blue-700');
            actionButton.disabled = false;
            document.getElementById('status-message').classList.add('hidden');
        } else {
            actionButton.textContent = `Check Answers (${answeredCount}/${QUIZ_LENGTH} Completed)`;
            actionButton.classList.remove('bg-robot-red', 'hover:bg-red-700', 'bg-robot-blue', 'hover:bg-blue-700');
            actionButton.classList.add('disabled-button');
            actionButton.disabled = true;
            document.getElementById('status-message').classList.add('hidden');
        }
    }

    /**
     * Toggles between checking answers and resetting the quiz based on the state.
     */
    function handleAction() {
        if (quizChecked) {
            resetQuiz();
        } else {
            checkAnswers();
        }
    }

    /**
     * Checks the student's answers and displays results and feedback.
     */
    function checkAnswers() {
        const selectElements = document.querySelectorAll('#quiz-container select');
        
        // 1. Mandatory: Check if all questions are answered
        let allAnswered = true;
        selectElements.forEach(select => {
            if (select.value === "") {
                allAnswered = false;
            }
            // Disable selections after checking
            select.disabled = true;
        });

        if (!allAnswered) {
            document.getElementById('status-message').classList.remove('hidden');
            // Re-enable selections if not all answered
            selectElements.forEach(select => {
                 if (select.value === "") select.disabled = false;
            });
            return; 
        }

        // --- Execute Check ---
        let score = 0;
        document.getElementById('results').classList.remove('hidden');

        quizData.forEach(q => {
            const selectElement = document.getElementById(`q-${q.id}`);
            const feedbackElement = document.getElementById(`feedback-${q.id}`);
            
            const selectedOptionIndex = selectElement.value;
            // The isCorrect property is retrieved from the original quizData object
            const isCorrect = q.options[parseInt(selectedOptionIndex)].isCorrect; 
            const correctAnswerText = q.options.find(opt => opt.isCorrect).text;

            if (isCorrect) {
                score++;
                feedbackElement.textContent = `Correct! (${correctAnswerText})`;
                feedbackElement.className = 'mt-2 font-medium text-sm text-robot-green';
                selectElement.classList.add('correct');
            } else {
                feedbackElement.textContent = `Incorrect. The correct answer is: ${correctAnswerText}`;
                feedbackElement.className = 'mt-2 font-medium text-sm text-robot-red';
                selectElement.classList.add('incorrect');
            }
        });

        // Display overall results
        document.getElementById('score-display').textContent = `Score: ${score} / ${QUIZ_LENGTH}`;
        const feedbackMessage = document.getElementById('feedback-message');
        
        if (score === QUIZ_LENGTH) {
            feedbackMessage.textContent = "Perfect Score! You have a rock-solid understanding of probabilistic state estimation.";
            feedbackMessage.className = 'mt-2 text-xl text-robot-green font-extrabold';
        } else if (score >= QUIZ_LENGTH * 0.8) {
            feedbackMessage.textContent = "Excellent! You have a strong grasp of the concepts.";
            feedbackMessage.className = 'mt-2 text-lg text-green-600 font-semibold';
        } else if (score >= QUIZ_LENGTH * 0.6) {
            feedbackMessage.textContent = "Good attempt! You're building a solid foundation. Keep reviewing the topics.";
            feedbackMessage.className = 'mt-2 text-lg text-yellow-600 font-semibold';
        } else {
            feedbackMessage.textContent = "Time for review! Take a moment to go through the provided notes to master these essential topics.";
            feedbackMessage.className = 'mt-2 text-lg text-robot-red font-semibold';
        }

        // 3. Force reset after checking once
        quizChecked = true;
        updateButtonState();
    }

    /**
     * Resets the entire quiz interface to the initial state.
     */
    function resetQuiz() {
        const selectElements = document.querySelectorAll('#quiz-container select');
        
        selectElements.forEach(select => {
            select.value = ""; // Clear selection
            select.disabled = false; // Enable selection
            select.classList.remove('correct', 'incorrect');
            
            const qId = select.id.split('-')[1];
            document.getElementById(`feedback-${qId}`).textContent = '';
        });

        document.getElementById('results').classList.add('hidden');
        document.getElementById('status-message').classList.add('hidden');
        
        quizChecked = false;
        updateButtonState();
    }


    /**
     * Initializes the quiz by generating the HTML for each question.
     */
    function renderQuiz() {
        const container = document.getElementById('quiz-container');
        container.innerHTML = quizData.map((q, index) => `
            <div class="question-block p-5 mb-6 bg-gray-50 rounded-lg border border-gray-200" data-question-id="${q.id}">
                <label for="q-${q.id}" class="block text-lg font-semibold text-gray-800 mb-3">
                    ${index + 1}. ${q.question}
                </label>
                <select 
                    id="q-${q.id}" 
                    onchange="updateButtonState()"
                    class="w-full p-3 border border-gray-300 rounded-lg bg-white text-gray-700 focus:ring-robot-blue focus:border-robot-blue appearance-none cursor-pointer"
                >
                    <option value="">-- Select your answer --</option>
                    ${q.options.map((opt, optIndex) => `
                        <option value="${optIndex}">${opt.text}</option>
                    `).join('')}
                </select>
                <div id="feedback-${q.id}" class="mt-2 font-medium text-sm"></div>
            </div>
        `).join('');

        updateButtonState(); // Set initial button state
    }

    // Initialize the quiz when the window loads
    window.onload = renderQuiz;
</script>
</body>
</html>
